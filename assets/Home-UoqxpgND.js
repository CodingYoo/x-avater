import{d as e,r as a,o as t,b as l,l as s,n as o,m as n,L as r,B as i,E as c,t as d,p as u,q as m,c as v,w as g,M as p,A as x,F as b,v as h,N as k,O as w,u as f,P as y,Q as C,j as I,z as M,y as B,R as j}from"./vue-vendor-DBUtO3nC.js";import{u as z,_ as S,a as E,P as L,g as $,b as Z,c as A,S as D,s as R,d as F,e as P}from"./index-C_GtIvNs.js";import"./ui-vendor-BeTP97BE.js";const H={class:"upload-container"},_={key:0,class:"upload-loading"},G={class:"text-lg font-medium text-gray-700 mt-4"},U={key:1,class:"upload-success"},Q={class:"text-lg font-medium text-gray-700 mb-2"},V={class:"text-sm text-gray-500 mb-4"},W={class:"text-xs text-gray-400"},T={key:2,class:"upload-prompt"},N={class:"text-xl font-semibold text-gray-700 mb-2"},J={class:"text-gray-500 mb-4"},O={class:"text-sm text-gray-400 space-y-1"},K={key:0,class:"alert alert-error mt-4"},Y={class:"font-medium"},X={key:0,class:"text-sm opacity-80"},q={key:1,class:"flex justify-center mt-6"},ee=["disabled"],ae=S(e({__name:"Upload",emits:["proceed"],setup(e){const v=z(),g=a(!1),p=a(),x=a(),b=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},h=()=>{v.isUploading||x.value?.click()},k=async e=>{const a=e.target,t=a.files?.[0];t&&await v.uploadFile(t),a.value=""},w=e=>{e.preventDefault(),g.value=!0},f=e=>{e.preventDefault(),p.value?.contains(e.relatedTarget)||(g.value=!1)},y=async e=>{e.preventDefault(),g.value=!1;const a=e.dataTransfer?.files;a&&a.length>0&&await v.uploadFile(a[0])},C=()=>{v.clearFile(),h()},I=e=>{e.preventDefault(),e.stopPropagation()};return t(()=>{["dragenter","dragover","dragleave","drop"].forEach(e=>{document.addEventListener(e,I,!1)})}),l(()=>{["dragenter","dragover","dragleave","drop"].forEach(e=>{document.removeEventListener(e,I,!1)})}),(e,a)=>(m(),s("div",H,[o("div",{ref_key:"uploadArea",ref:p,class:i(["upload-area",{dragover:g.value,uploading:c(v).isUploading,"has-file":c(v).hasFile}]),onClick:h,onDragover:r(w,["prevent"]),onDragleave:r(f,["prevent"]),onDrop:r(y,["prevent"])},[o("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/jpeg,image/png,image/webp",class:"hidden",onChange:k},null,544),c(v).isUploading?(m(),s("div",_,[a[2]||(a[2]=o("div",{class:"loading-spinner"},null,-1)),o("p",G,d(e.$t("upload.processing")),1)])):c(v).hasFile?(m(),s("div",U,[a[3]||(a[3]=o("div",{class:"flex items-center justify-center mb-4"},[o("svg",{class:"w-16 h-16 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),o("p",Q,d(e.$t("upload.success")),1),o("p",V,d(c(v).fileName),1),o("p",W,d(e.$t("upload.size"))+": "+d(c(v).uploadedFile?.width)+" × "+d(c(v).uploadedFile?.height)+" | "+d(e.$t("upload.fileSize"))+": "+d(b(c(v).fileSize)),1),o("button",{onClick:r(C,["stop"]),class:"btn btn-outline btn-sm mt-4"},d(e.$t("upload.reupload")),1)])):(m(),s("div",T,[a[4]||(a[4]=o("div",{class:"flex items-center justify-center mb-4"},[o("svg",{class:"w-16 h-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})])],-1)),o("h3",N,d(e.$t("upload.title")),1),o("p",J,d(e.$t("upload.subtitle")),1),o("div",O,[o("p",null,d(e.$t("upload.formats")),1),o("p",null,d(e.$t("upload.maxSize")),1),o("p",null,d(e.$t("upload.recommended")),1)])]))],34),c(v).error?(m(),s("div",K,[a[6]||(a[6]=o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("div",null,[o("h4",Y,d(c(v).error.message),1),"FILE_TOO_LARGE"===c(v).error.code?(m(),s("p",X,d(e.$t("upload.errors.currentSize"))+"："+d(b(c(v).error.details?.size||0)),1)):n("",!0)]),o("button",{onClick:a[0]||(a[0]=(...e)=>c(v).clearError&&c(v).clearError(...e)),class:"btn btn-sm btn-ghost"},[...a[5]||(a[5]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):n("",!0),c(v).hasFile&&!c(v).isUploading?(m(),s("div",q,[o("button",{onClick:a[1]||(a[1]=a=>e.$emit("proceed")),class:"btn btn-primary btn-lg",disabled:!c(v).hasFile},[u(d(e.$t("upload.proceed"))+" ",1),a[7]||(a[7]=o("svg",{class:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1))],8,ee)])):n("",!0)]))}}),[["__scopeId","data-v-7a12c6a5"]]),te={class:"preview-container"},le=["width","height"],se=["width","height"],oe={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg"},ne={class:"text-center text-white"},re={class:"text-sm"},ie={key:0,class:"w-32 bg-gray-600 rounded-full h-1 mt-2 mx-auto"},ce={class:"absolute top-2 right-2 flex space-x-2"},de={class:"dropdown dropdown-end"},ue={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-40"},me={class:"mt-4 text-center text-sm text-gray-500"},ve={class:"flex justify-center items-center space-x-4"},ge={key:0},pe={key:1},xe={key:0,class:"alert alert-error mt-4"},be={class:"text-sm opacity-80"},he=S(e({__name:"Preview",props:{originalImage:{},segmentationMask:{},background:{},size:{default:512},autoRender:{type:Boolean,default:!0}},emits:["reprocess","rendered"],setup(e,{expose:r,emit:c}){const u=e,b=c,h=a(),k=a(),w=a(!1),f=a(""),y=a(0),C=a(""),I=a("composite"),M=a(0),B=v(()=>u.size),j=v(()=>u.originalImage&&u.segmentationMask),z=async()=>{if(!u.originalImage||!u.segmentationMask||!u.background)return;if(!h.value||!k.value)return;w.value=!0,f.value="正在渲染预览...",y.value=0,C.value="";const e=Date.now();try{const a=h.value.getContext("2d"),t=k.value.getContext("2d");if(a.clearRect(0,0,B.value,B.value),t.clearRect(0,0,B.value,B.value),y.value=20,"color"===u.background.type)a.fillStyle=u.background.value,a.fillRect(0,0,B.value,B.value);else{const e=u.background.value;a.drawImage(e,0,0,B.value,B.value)}y.value=50;const l=document.createElement("canvas"),s=l.getContext("2d");l.width=B.value,l.height=B.value,s.drawImage(u.originalImage,0,0,B.value,B.value),y.value=70,s.globalCompositeOperation="destination-in",s.drawImage(u.segmentationMask,0,0,B.value,B.value),y.value=90,t.drawImage(l,0,0),y.value=100,M.value=Date.now()-e,await p();const o=S();o&&b("rendered",o)}catch(a){C.value=`渲染失败: ${a}`}finally{w.value=!1,f.value="",y.value=0}},S=()=>{if(!h.value||!k.value)return null;const e=document.createElement("canvas"),a=e.getContext("2d");return e.width=B.value,e.height=B.value,a.drawImage(h.value,0,0),a.drawImage(k.value,0,0),e},E=e=>{I.value=e,L()},L=()=>{if(!h.value||!k.value)return;const e=h.value.getContext("2d"),a=k.value.getContext("2d");switch(e.clearRect(0,0,B.value,B.value),a.clearRect(0,0,B.value,B.value),I.value){case"original":u.originalImage&&e.drawImage(u.originalImage,0,0,B.value,B.value);break;case"mask":u.segmentationMask&&(e.fillStyle="#000000",e.fillRect(0,0,B.value,B.value),e.drawImage(u.segmentationMask,0,0,B.value,B.value));break;default:z()}},$=()=>{C.value=""};return g(()=>[u.originalImage,u.segmentationMask,u.background],()=>{u.autoRender&&p(()=>{L()})},{deep:!0}),g(I,()=>{L()}),t(()=>{u.autoRender&&p(()=>{L()})}),l(()=>{if(h.value){const e=h.value.getContext("2d");e&&e.clearRect(0,0,B.value,B.value)}if(k.value){const e=k.value.getContext("2d");e&&e.clearRect(0,0,B.value,B.value)}}),r({renderComposite:z,createCompositeCanvas:S,setViewMode:E}),(e,a)=>(m(),s("div",te,[a[10]||(a[10]=o("div",{class:"text-center mb-6"},[o("h3",{class:"text-xl font-semibold text-gray-800 mb-2"},"实时预览"),o("p",{class:"text-gray-600"},"查看AI抠图和背景合成效果")],-1)),o("div",{class:"canvas-container relative mx-auto aspect-square w-full max-w-lg",style:x({maxWidth:B.value+"px",maxHeight:B.value+"px"})},[o("canvas",{ref_key:"backgroundCanvas",ref:h,class:"canvas-layer absolute top-0 left-0 w-full h-full rounded-lg shadow-lg",width:B.value,height:B.value},null,8,le),o("canvas",{ref_key:"foregroundCanvas",ref:k,class:"canvas-layer absolute top-0 left-0 w-full h-full rounded-lg",width:B.value,height:B.value},null,8,se),w.value?(m(),s("div",oe,[o("div",ne,[a[4]||(a[4]=o("div",{class:"loading-spinner mx-auto mb-4"},null,-1)),o("p",re,d(f.value),1),y.value>0?(m(),s("div",ie,[o("div",{class:"bg-white h-1 rounded-full transition-all duration-300",style:x({width:y.value+"%"})},null,4)])):n("",!0)])])):n("",!0),o("div",ce,[o("div",de,[a[5]||(a[5]=o("label",{tabindex:"0",class:"btn btn-sm btn-circle btn-ghost bg-white bg-opacity-80 hover:bg-opacity-100"},[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})])],-1)),o("ul",ue,[o("li",null,[o("a",{onClick:a[0]||(a[0]=e=>E("composite")),class:i({active:"composite"===I.value})},"合成效果",2)]),o("li",null,[o("a",{onClick:a[1]||(a[1]=e=>E("original")),class:i({active:"original"===I.value})},"原始图片",2)]),o("li",null,[o("a",{onClick:a[2]||(a[2]=e=>E("mask")),class:i({active:"mask"===I.value})},"分割蒙版",2)])])]),j.value?(m(),s("button",{key:0,onClick:a[3]||(a[3]=a=>e.$emit("reprocess")),class:"btn btn-sm btn-circle btn-ghost bg-white bg-opacity-80 hover:bg-opacity-100",title:"重新处理"},[...a[6]||(a[6]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):n("",!0)])],4),o("div",me,[o("div",ve,[o("span",null,"尺寸: "+d(B.value)+"×"+d(B.value),1),e.originalImage?(m(),s("span",ge,"原图: "+d(e.originalImage.width)+"×"+d(e.originalImage.height),1)):n("",!0),M.value>0?(m(),s("span",pe,"渲染: "+d(M.value)+"ms",1)):n("",!0)])]),C.value?(m(),s("div",xe,[a[9]||(a[9]=o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("div",null,[a[7]||(a[7]=o("h4",{class:"font-medium"},"预览渲染失败",-1)),o("p",be,d(C.value),1)]),o("button",{onClick:$,class:"btn btn-sm btn-ghost"},[...a[8]||(a[8]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):n("",!0)]))}}),[["__scopeId","data-v-ad825c25"]]),ke={class:"background-picker"},we={class:"text-center mb-6"},fe={class:"text-xl font-semibold text-gray-800 mb-2"},ye={class:"text-gray-600"},Ce={class:"tabs tabs-boxed mb-6 justify-center"},Ie={key:0,class:"color-section"},Me={class:"grid grid-cols-4 gap-3 mb-6"},Be=["onClick","title"],je={key:0,class:"check-icon"},ze={class:"custom-color-section"},Se={class:"flex items-center space-x-3"},Ee={class:"flex-1"},Le=["disabled"],$e={key:1,class:"image-section"},Ze={key:0,class:"upload-loading"},Ae={key:1,class:"upload-success"},De={class:"preview-image mb-4"},Re={key:2,class:"upload-prompt"},Fe={class:"preset-images mt-6"},Pe={class:"grid grid-cols-3 gap-3"},He=["onClick"],_e=["src","alt"],Ge={class:"text-xs text-gray-600 mt-1"},Ue={key:2,class:"alert alert-error mt-4"},Qe={class:"font-medium"},Ve={key:0,class:"text-sm opacity-80"},We=S(e({__name:"BackgroundPicker",emits:["background-changed"],setup(e,{emit:l}){const y=l,C=E(),I=a("color"),M=a("#FF6B6B"),B=a(!1),j=a(),z=a(),S=a(-1),$=L,Z=[{name:"渐变蓝",thumbnail:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM0Rjc5QTQiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM1Qzk2QzQiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0idXJsKCNhKSIvPjwvc3ZnPg=="},{name:"渐变紫",thumbnail:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiM4QjVDRjYiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNBNzc4RkYiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0idXJsKCNhKSIvPjwvc3ZnPg=="},{name:"渐变绿",thumbnail:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiMzNEQ0MDEiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM2NEQ0MDEiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0idXJsKCNhKSIvPjwvc3ZnPg=="}],A=v(()=>C.selectedBackground),D=e=>{I.value=e,"color"===e&&"color"!==A.value?.type&&R($[0])},R=e=>{F(e)&&(C.setColorBackground(e),y("background-changed",{type:"color",value:e}))},F=e=>/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(e),P=()=>{F(M.value)&&R(M.value)},H=()=>{C.isLoadingBackground||j.value?.click()},_=async e=>{const a=e.target,t=a.files?.[0];if(t){await C.setImageBackground(t)&&(S.value=-1,await p(),W(),y("background-changed",C.selectedBackground))}a.value=""},G=e=>{e.preventDefault(),B.value=!0},U=e=>{e.preventDefault(),B.value=!1},Q=async e=>{e.preventDefault(),B.value=!1;const a=e.dataTransfer?.files;if(a&&a.length>0){await C.setImageBackground(a[0])&&(S.value=-1,await p(),W(),y("background-changed",C.selectedBackground))}},V=()=>{C.resetBackground(),S.value=-1,D("color")},W=()=>{if(!z.value||"image"!==A.value?.type)return;const e=z.value.getContext("2d"),a=A.value.value;e.clearRect(0,0,128,128),e.drawImage(a,0,0,128,128)};return g(A,()=>{"image"===A.value?.type?(I.value="image",p(()=>{W()})):"color"===A.value?.type&&(I.value="color")},{deep:!0}),t(()=>{"image"===A.value?.type&&p(()=>{W()})}),(e,a)=>(m(),s("div",ke,[o("div",we,[o("h3",fe,d(e.$t("background.title")),1),o("p",ye,d(e.$t("background.subtitle")),1)]),o("div",Ce,[o("a",{class:i(["tab",{"tab-active":"color"===I.value}]),onClick:a[0]||(a[0]=e=>D("color"))},[a[8]||(a[8]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})],-1)),u(" "+d(e.$t("background.colorTab")),1)],2),o("a",{class:i(["tab",{"tab-active":"image"===I.value}]),onClick:a[1]||(a[1]=e=>D("image"))},[a[9]||(a[9]=o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),u(" "+d(e.$t("background.imageTab")),1)],2)]),"color"===I.value?(m(),s("div",Ie,[a[12]||(a[12]=o("h4",{class:"text-lg font-medium text-gray-700 mb-4"},"预设颜色",-1)),o("div",Me,[(m(!0),s(b,null,h(c($),e=>(m(),s("button",{key:e,class:i(["color-option",{selected:"color"===A.value?.type&&A.value.value===e}]),style:x({backgroundColor:e}),onClick:a=>R(e),title:e},["color"===A.value?.type&&A.value.value===e?(m(),s("div",je,[...a[10]||(a[10]=[o("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"})],-1)])])):n("",!0)],14,Be))),128))]),o("div",ze,[a[11]||(a[11]=o("h5",{class:"text-md font-medium text-gray-600 mb-3"},"自定义颜色",-1)),o("div",Se,[k(o("input",{type:"color","onUpdate:modelValue":a[2]||(a[2]=e=>M.value=e),class:"color-input w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer",onChange:a[3]||(a[3]=e=>R(M.value))},null,544),[[w,M.value]]),o("div",Ee,[k(o("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>M.value=e),placeholder:"#FF6B6B",class:"input input-bordered w-full",onInput:P,onBlur:a[5]||(a[5]=e=>R(M.value))},null,544),[[w,M.value]])]),o("button",{onClick:a[6]||(a[6]=e=>R(M.value)),class:"btn btn-primary",disabled:!F(M.value)}," 应用 ",8,Le)])])])):"image"===I.value?(m(),s("div",$e,[o("div",{class:i(["upload-area",{dragover:B.value,uploading:c(C).isLoadingBackground}]),onClick:H,onDragover:r(G,["prevent"]),onDragleave:r(U,["prevent"]),onDrop:r(Q,["prevent"])},[o("input",{ref_key:"imageInput",ref:j,type:"file",accept:"image/jpeg,image/png,image/webp",class:"hidden",onChange:_},null,544),c(C).isLoadingBackground?(m(),s("div",Ze,[...a[13]||(a[13]=[o("div",{class:"loading-spinner"},null,-1),o("p",{class:"text-lg font-medium text-gray-700 mt-4"},"正在加载背景图片...",-1)])])):"image"===A.value?.type?(m(),s("div",Ae,[o("div",De,[o("canvas",{ref_key:"imagePreviewCanvas",ref:z,class:"w-32 h-32 mx-auto rounded-lg shadow-md",width:"128",height:"128"},null,512)]),a[14]||(a[14]=o("p",{class:"text-lg font-medium text-gray-700 mb-2"},"背景图片已选择",-1)),o("button",{onClick:r(V,["stop"]),class:"btn btn-outline btn-sm"}," 重新选择 ")])):(m(),s("div",Re,[...a[15]||(a[15]=[f('<div class="flex items-center justify-center mb-4" data-v-88c13dc4><svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-88c13dc4><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" data-v-88c13dc4></path></svg></div><h4 class="text-lg font-semibold text-gray-700 mb-2" data-v-88c13dc4>上传背景图片</h4><p class="text-gray-500 mb-4" data-v-88c13dc4>点击或拖拽图片到此区域</p><div class="text-sm text-gray-400 space-y-1" data-v-88c13dc4><p data-v-88c13dc4>支持格式：JPG、PNG、WEBP</p><p data-v-88c13dc4>文件大小：最大 10MB</p><p data-v-88c13dc4>建议尺寸：512×512 像素或更高</p></div>',4)])]))],34),o("div",Fe,[a[16]||(a[16]=o("h5",{class:"text-md font-medium text-gray-600 mb-3"},"预设背景",-1)),o("div",Pe,[(m(),s(b,null,h(Z,(e,a)=>o("button",{key:a,class:i(["preset-bg-option",{selected:S.value===a}]),onClick:e=>(async e=>{S.value=e;const a=document.createElement("canvas");a.width=512,a.height=512;const t=a.getContext("2d"),l=t.createLinearGradient(0,0,512,512),s=Z[e];"渐变蓝"===s.name?(l.addColorStop(0,"#4F79A4"),l.addColorStop(1,"#5C96C4")):"渐变紫"===s.name?(l.addColorStop(0,"#8B5CF6"),l.addColorStop(1,"#A778FF")):(l.addColorStop(0,"#34D401"),l.addColorStop(1,"#64D401")),t.fillStyle=l,t.fillRect(0,0,512,512);const o=await createImageBitmap(a);C.selectedBackground={type:"image",value:o},await p(),W(),y("background-changed",C.selectedBackground)})(a)},[o("img",{src:e.thumbnail,alt:e.name,class:"w-full h-20 object-cover rounded"},null,8,_e),o("span",Ge,d(e.name),1)],10,He)),64))])])])):n("",!0),c(C).error?(m(),s("div",Ue,[a[18]||(a[18]=o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("div",null,[o("h4",Qe,d(c(C).error.message),1),"BACKGROUND_TOO_LARGE"===c(C).error.code?(m(),s("p",Ve," 文件大小限制：10MB ")):n("",!0)]),o("button",{onClick:a[7]||(a[7]=(...e)=>c(C).clearError&&c(C).clearError(...e)),class:"btn btn-sm btn-ghost"},[...a[17]||(a[17]=[o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):n("",!0)]))}}),[["__scopeId","data-v-88c13dc4"]]),Te={class:"download-section"},Ne={class:"download-options mb-6"},Je={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Oe={class:"option-group"},Ke={class:"option-group"},Ye={key:0,class:"quality-section mt-4"},Xe={class:"label"},qe={class:"label-text font-medium"},ea={class:"preview-info bg-gray-50 rounded-lg p-4 mb-6"},aa={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 text-sm"},ta={class:"info-item"},la={class:"font-medium ml-1"},sa={class:"info-item"},oa={class:"font-medium ml-1"},na={class:"info-item"},ra={class:"font-medium ml-1"},ia={class:"download-actions"},ca=["disabled"],da={key:0,class:"w-4 h-4 sm:w-5 sm:h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ua={class:"batch-download mt-4"},ma={class:"collapse collapse-arrow bg-base-200"},va={class:"collapse-content"},ga={class:"space-y-3 pt-2"},pa={class:"cursor-pointer label justify-start"},xa={class:"cursor-pointer label justify-start"},ba=["disabled"],ha={key:0,class:"download-history mt-6"},ka={class:"space-y-2 max-h-32 overflow-y-auto"},wa={class:"flex items-center"},fa={class:"text-gray-700"},ya={class:"text-gray-500"},Ca={key:1,class:"alert alert-error mt-4"},Ia={class:"text-sm opacity-80"},Ma=S(e({__name:"DownloadBtn",props:{canvas:{},originalImage:{},segmentationMask:{},background:{},disabled:{type:Boolean,default:!1}},emits:["download-start","download-complete","download-error"],setup(e,{emit:t}){const l=e,r=t,c=a("png"),p=a("512"),x=a(.9),f=a(!1),I=a(""),M=a({allSizes:!1,allFormats:!1}),B=a([]),j=v(()=>!l.disabled&&l.canvas&&!f.value),z=v(()=>j.value&&(M.value.allSizes||M.value.allFormats)),S=v(()=>{const e=parseInt(p.value),a=e*e;let t=4;"jpg"===c.value?t=3*x.value:"webp"===c.value&&(t=2.5);const l=a*t;return l<1024?`${Math.round(l)} B`:l<1048576?`${Math.round(l/1024)} KB`:`${(l/1048576).toFixed(1)} MB`}),E=async()=>{if(j.value){f.value=!0,I.value="",r("download-start");try{const e=(e=>{if(!l.originalImage||!l.segmentationMask||!l.background)return null;const a=document.createElement("canvas"),t=a.getContext("2d");a.width=e,a.height=e;try{"color"===l.background.type?(t.fillStyle=l.background.value,t.fillRect(0,0,e,e)):t.drawImage(l.background.value,0,0,e,e);const s=document.createElement("canvas"),o=s.getContext("2d");return s.width=e,s.height=e,o.drawImage(l.originalImage,0,0,e,e),o.globalCompositeOperation="destination-in",o.drawImage(l.segmentationMask,0,0,e,e),t.drawImage(s,0,0),a}catch(s){return null}})(parseInt(p.value));if(!e)throw new Error("无法创建下载画布");const a=`image/${c.value}`,t="jpg"===c.value?x.value:void 0,s=await new Promise((l,s)=>{e.toBlob(e=>{e?l(e):s(new Error("无法生成图片"))},a,t)}),o=URL.createObjectURL(s),n=`avatar_${(new Date).toISOString().slice(0,19).replace(/[:-]/g,"")}.${c.value}`,i=document.createElement("a");i.href=o,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>URL.revokeObjectURL(o),1e3);const d=$(s.size);B.value.unshift({filename:n,size:d,timestamp:new Date}),B.value.length>5&&(B.value=B.value.slice(0,5)),r("download-complete",n,d)}catch(e){const a=e instanceof Error?e.message:"下载失败";I.value=a,r("download-error",a)}finally{f.value=!1}}},L=async()=>{if(!z.value)return;const e=M.value.allSizes?["256","512","1024"]:[p.value],a=M.value.allFormats?["png","jpg","webp"]:[c.value];for(const t of e)for(const e of a){const a=p.value,l=c.value;p.value=t,c.value=e,await E(),await new Promise(e=>setTimeout(e,500)),p.value=a,c.value=l}},$=e=>e<1024?`${e} B`:e<1048576?`${Math.round(e/1024)} KB`:`${(e/1048576).toFixed(1)} MB`,Z=()=>{I.value=""};return g(c,e=>{"jpg"===e&&x.value>.95?x.value=.9:"webp"===e&&x.value<.8&&(x.value=.85)}),(e,a)=>(m(),s("div",Te,[a[21]||(a[21]=o("div",{class:"text-center mb-6"},[o("h3",{class:"text-xl font-semibold text-gray-800 mb-2"},"下载结果"),o("p",{class:"text-gray-600"},"保存您的个性化头像")],-1)),o("div",Ne,[o("div",Je,[o("div",Oe,[a[6]||(a[6]=o("label",{class:"label"},[o("span",{class:"label-text font-medium text-sm sm:text-base"},"文件格式")],-1)),k(o("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),class:"select select-bordered w-full text-sm sm:text-base"},[...a[5]||(a[5]=[o("option",{value:"png"},"PNG (推荐)",-1),o("option",{value:"jpg"},"JPG",-1),o("option",{value:"webp"},"WebP",-1)])],512),[[y,c.value]])]),o("div",Ke,[a[8]||(a[8]=o("label",{class:"label"},[o("span",{class:"label-text font-medium text-sm sm:text-base"},"图片尺寸")],-1)),k(o("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),class:"select select-bordered w-full text-sm sm:text-base"},[...a[7]||(a[7]=[o("option",{value:"512"},"512×512 (标准)",-1),o("option",{value:"1024"},"1024×1024 (高清)",-1),o("option",{value:"256"},"256×256 (小尺寸)",-1)])],512),[[y,p.value]])])]),"jpg"===c.value?(m(),s("div",Ye,[o("label",Xe,[o("span",qe,"图片质量: "+d(Math.round(100*x.value))+"%",1)]),k(o("input",{type:"range",min:"0.1",max:"1",step:"0.1","onUpdate:modelValue":a[2]||(a[2]=e=>x.value=e),class:"range range-primary"},null,512),[[w,x.value,void 0,{number:!0}]]),a[9]||(a[9]=o("div",{class:"w-full flex justify-between text-xs text-gray-500 mt-1"},[o("span",null,"低质量"),o("span",null,"中等质量"),o("span",null,"高质量")],-1))])):n("",!0)]),o("div",ea,[o("div",aa,[o("div",ta,[a[10]||(a[10]=o("span",{class:"text-gray-600"},"格式:",-1)),o("span",la,d(c.value.toUpperCase()),1)]),o("div",sa,[a[11]||(a[11]=o("span",{class:"text-gray-600"},"尺寸:",-1)),o("span",oa,d(p.value)+"×"+d(p.value),1)]),o("div",na,[a[12]||(a[12]=o("span",{class:"text-gray-600"},"预估大小:",-1)),o("span",ra,d(S.value),1)])])]),o("div",ia,[o("button",{onClick:E,disabled:!j.value||f.value,class:i(["btn btn-primary btn-lg w-full text-sm sm:text-base",{loading:f.value}])},[f.value?n("",!0):(m(),s("svg",da,[...a[13]||(a[13]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-4-4m4 4l4-4m-6 4h8a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v8a2 2 0 002 2h8z"},null,-1)])])),u(" "+d(f.value?"正在生成...":"下载头像"),1)],10,ca),o("div",ua,[o("details",ma,[a[16]||(a[16]=o("summary",{class:"collapse-title text-sm font-medium"},"批量下载选项",-1)),o("div",va,[o("div",ga,[o("label",pa,[k(o("input",{type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=e=>M.value.allSizes=e),class:"checkbox checkbox-sm mr-3"},null,512),[[C,M.value.allSizes]]),a[14]||(a[14]=o("span",{class:"label-text"},"下载所有尺寸",-1))]),o("label",xa,[k(o("input",{type:"checkbox","onUpdate:modelValue":a[4]||(a[4]=e=>M.value.allFormats=e),class:"checkbox checkbox-sm mr-3"},null,512),[[C,M.value.allFormats]]),a[15]||(a[15]=o("span",{class:"label-text"},"下载所有格式",-1))]),o("button",{onClick:L,disabled:!z.value||f.value,class:"btn btn-outline btn-sm w-full"}," 批量下载 ",8,ba)])])])])]),B.value.length>0?(m(),s("div",ha,[a[18]||(a[18]=o("h4",{class:"text-md font-medium text-gray-700 mb-3"},"下载历史",-1)),o("div",ka,[(m(!0),s(b,null,h(B.value,(e,t)=>(m(),s("div",{key:t,class:"flex items-center justify-between text-sm bg-white p-2 rounded border"},[o("div",wa,[a[17]||(a[17]=o("svg",{class:"w-4 h-4 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("span",fa,d(e.filename),1)]),o("span",ya,d(e.size),1)]))),128))])])):n("",!0),I.value?(m(),s("div",Ca,[a[20]||(a[20]=o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("div",null,[a[19]||(a[19]=o("h4",{class:"font-medium"},"下载失败",-1)),o("p",Ia,d(I.value),1)]),o("button",{onClick:Z,class:"btn btn-sm btn-ghost"},"关闭")])):n("",!0)]))}}),[["__scopeId","data-v-0af5465c"]]),Ba={class:"language-switcher"},ja={class:"dropdown dropdown-end"},za={tabindex:"0",class:"btn btn-ghost btn-sm gap-2"},Sa={class:"text-lg"},Ea={class:"hidden md:inline"},La={tabindex:"0",class:"dropdown-content menu p-2 shadow-lg bg-base-100 rounded-box w-48 border border-gray-200 z-50"},$a={class:"menu-title"},Za=["onClick"],Aa={class:"text-lg"},Da={key:0,class:"w-4 h-4 text-primary ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ra={key:0,class:"language-toast"},Fa={class:"alert alert-success-custom shadow-md"},Pa={class:"text-sm"},Ha=S(e({__name:"LanguageSwitcher",emits:["language-changed"],setup(e,{expose:l,emit:r}){const u=a(!1),g=a(""),p=v(()=>$()),x=async e=>{if(e===p.value){const e=document.activeElement;return void(e&&e.blur())}try{const a=A(p.value),t=A(e);R(e);const l=document.activeElement;l&&l.blur(),g.value=`${a} → ${t}`,u.value=!0,setTimeout(()=>{u.value=!1},3e3),w("language-changed",e)}catch(a){}},k=e=>{if(e.altKey&&"l"===e.key){e.preventDefault();const a=document.querySelector(".language-switcher label");a&&a.focus()}if("Escape"===e.key){const e=document.activeElement;e&&e.blur()}},w=r;return t(()=>(document.addEventListener("keydown",k),()=>{document.removeEventListener("keydown",k)})),l({switchLanguage:x,getCurrentLocale:()=>p.value}),(e,a)=>(m(),s("div",Ba,[o("div",ja,[o("label",za,[o("span",Sa,d(c(Z)(p.value)),1),o("span",Ea,d(c(A)(p.value)),1),a[0]||(a[0]=o("svg",{class:"w-4 h-4 hidden sm:block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),o("ul",La,[o("li",$a,[o("span",null,d(e.$t("header.languageSwitch")),1)]),(m(!0),s(b,null,h(c(D),e=>(m(),s("li",{key:e.code},[o("a",{onClick:a=>x(e.code),class:i([{active:e.code===p.value},"flex items-center gap-3"])},[o("span",Aa,d(e.flag),1),o("span",null,d(e.name),1),e.code===p.value?(m(),s("svg",Da,[...a[1]||(a[1]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):n("",!0)],10,Za)]))),128))])]),I(M,{name:"language-toast"},{default:B(()=>[u.value?(m(),s("div",Ra,[o("div",Fa,[a[2]||(a[2]=o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),o("div",Pa,d(g.value),1)])])):n("",!0)]),_:1})]))}}),[["__scopeId","data-v-18f81f16"]]),_a={class:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50"},Ga={class:"bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-40"},Ua={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Qa={class:"flex flex-col sm:flex-row justify-between items-center py-4 sm:py-6 space-y-4 sm:space-y-0"},Va={class:"flex items-center"},Wa={class:"flex items-center space-x-3"},Ta={class:"min-w-0 flex-1"},Na={class:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 truncate"},Ja={class:"text-xs sm:text-sm text-gray-600 hidden sm:block"},Oa={class:"flex items-center space-x-2 sm:space-x-4"},Ka={class:"flex items-center space-x-2 sm:space-x-3"},Ya={class:"text-xs sm:text-sm text-gray-500 hidden md:block"},Xa={class:"progress-bar w-16 sm:w-24 lg:w-32"},qa={class:"text-xs sm:text-sm font-medium text-gray-700 min-w-0"},et={class:"max-w-4xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-6 lg:py-8"},at={class:"mb-6 sm:mb-8 fade-in-up"},tt={"aria-label":"Progress",class:"px-2 sm:px-4"},lt={class:"flex items-center justify-center space-x-1 sm:space-x-3 lg:space-x-5 overflow-x-auto pb-2"},st={class:"flex items-center flex-shrink-0"},ot={class:"flex flex-col sm:flex-row items-center"},nt={key:0,class:"text-white text-sm sm:text-base"},rt={key:1,class:"text-xs sm:text-sm font-medium"},it={class:"mt-1 sm:mt-0 sm:ml-2 lg:ml-3 text-xs sm:text-sm font-medium text-gray-900 text-center sm:text-left"},ct={class:"flex items-center flex-shrink-0"},dt={class:"flex flex-col sm:flex-row items-center sm:ml-2 lg:ml-4"},ut={key:0,class:"text-white text-sm sm:text-base"},mt={key:1,class:"text-xs sm:text-sm font-medium"},vt={class:"mt-1 sm:mt-0 sm:ml-2 lg:ml-3 text-xs sm:text-sm font-medium text-gray-900 text-center sm:text-left"},gt={class:"flex items-center flex-shrink-0"},pt={class:"flex flex-col sm:flex-row items-center sm:ml-2 lg:ml-4"},xt={key:0,class:"text-white text-sm sm:text-base"},bt={key:1,class:"text-xs sm:text-sm font-medium"},ht={class:"mt-1 sm:mt-0 sm:ml-2 lg:ml-3 text-xs sm:text-sm font-medium text-gray-900 text-center sm:text-left"},kt={class:"flex items-center flex-shrink-0"},wt={class:"flex flex-col sm:flex-row items-center sm:ml-2 lg:ml-4"},ft={key:0,class:"text-white text-sm sm:text-base"},yt={key:1,class:"text-xs sm:text-sm font-medium"},Ct={class:"mt-1 sm:mt-0 sm:ml-2 lg:ml-3 text-xs sm:text-sm font-medium text-gray-900 text-center sm:text-left"},It={class:"card-enhanced p-6 sm:p-8 fade-in-up"},Mt={key:0},Bt={key:1},jt={class:"text-center"},zt={class:"text-2xl font-bold text-gray-900 mb-4"},St={class:"text-gray-600 mb-6"},Et={key:0,class:"space-y-4"},Lt={class:"w-64 bg-gray-200 rounded-full h-2 mx-auto"},$t={class:"text-sm text-gray-500"},Zt={key:1,class:"space-y-4"},At={class:"text-lg font-medium text-gray-700"},Dt={key:2},Rt={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Ft={class:"preview-section"},Pt={class:"background-section"},Ht={class:"segmentation-options mt-6 p-4 bg-gray-50 rounded-lg"},_t={class:"flex items-center space-x-4"},Gt={class:"flex items-center cursor-pointer"},Ut={class:"flex items-center cursor-pointer"},Qt=["disabled"],Vt={class:"flex justify-between mt-6"},Wt=["disabled"],Tt={key:3},Nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Jt={class:"final-preview"},Ot={class:"download-section"},Kt={class:"flex justify-between mt-6"},Yt={key:0,class:"mt-6"},Xt={class:"alert alert-error"},qt={class:"font-medium"},el={class:"text-sm opacity-80"},al=e({__name:"Home",setup(e){const t=F(),l=z(),r=P(),v=E(),g=a(),p=e=>{const a=t.currentStep;return b(e)?"bg-blue-600 text-white":a===e?"bg-blue-100 text-blue-600 border-2 border-blue-600":"bg-gray-200 text-gray-500"},b=e=>{const a=["upload","segment","background","download"],l=a.indexOf(t.currentStep);return a.indexOf(e)<l},h=async()=>{try{await t.processImage()}catch(e){}},w=e=>{},f=async()=>{if(l.uploadedFile?.imageBitmap)try{r.clearSegmentation();await r.performSegmentation(l.uploadedFile.imageBitmap)}catch(e){}},y=e=>{},C=e=>{g.value=e},M=async()=>{l.uploadedFile?.imageBitmap&&await r.performSegmentation(l.uploadedFile.imageBitmap)},B=()=>{},S=(e,a)=>{},L=e=>{},$=e=>{};return(e,a)=>(m(),s("div",_a,[o("header",Ga,[o("div",Ua,[o("div",Qa,[o("div",Va,[o("div",Wa,[a[8]||(a[8]=o("div",{class:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center"},[o("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),o("div",Ta,[o("h1",Na,d(e.$t("app.title")),1),o("p",Ja,d(e.$t("app.subtitle")),1)])])]),o("div",Oa,[o("div",Ka,[o("div",Ya,d(e.$t("header.progress")),1),o("div",Xa,[o("div",{class:"progress-fill",style:x({width:`${c(t).overallProgress}%`})},null,4)]),o("div",qa,d(c(t).overallProgress)+"%",1)]),I(Ha,{onLanguageChanged:$})])])])]),o("main",et,[o("div",at,[o("nav",tt,[o("ol",lt,[o("li",st,[o("div",ot,[o("div",{class:i(["step-indicator w-8 h-8 sm:w-10 sm:h-10",p("upload")])},[b("upload")?(m(),s("span",nt,"✓")):(m(),s("span",rt,"1"))],2),o("span",it,d(e.$t("steps.upload")),1)])]),o("li",ct,[a[9]||(a[9]=o("svg",{class:"flex-shrink-0 w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 text-gray-300 hidden sm:block",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)),o("div",dt,[o("div",{class:i(["step-indicator w-8 h-8 sm:w-10 sm:h-10",p("segment")])},[b("segment")?(m(),s("span",ut,"✓")):(m(),s("span",mt,"2"))],2),o("span",vt,d(e.$t("steps.segment")),1)])]),o("li",gt,[a[10]||(a[10]=o("svg",{class:"flex-shrink-0 w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 text-gray-300 hidden sm:block",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)),o("div",pt,[o("div",{class:i(["step-indicator w-8 h-8 sm:w-10 sm:h-10",p("background")])},[b("background")?(m(),s("span",xt,"✓")):(m(),s("span",bt,"3"))],2),o("span",ht,d(e.$t("steps.background")),1)])]),o("li",kt,[a[11]||(a[11]=o("svg",{class:"flex-shrink-0 w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 text-gray-300 hidden sm:block",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)),o("div",wt,[o("div",{class:i(["step-indicator w-8 h-8 sm:w-10 sm:h-10",p("download")])},[b("download")?(m(),s("span",ft,"✓")):(m(),s("span",yt,"4"))],2),o("span",Ct,d(e.$t("steps.download")),1)])])])])]),o("div",It,["upload"===c(t).currentStep?(m(),s("div",Mt,[I(ae,{onProceed:h})])):"segment"===c(t).currentStep?(m(),s("div",Bt,[o("div",jt,[o("h2",zt,d(e.$t("segmentation.title")),1),o("p",St,d(e.$t("segmentation.subtitle")),1),c(r).isProcessing?(m(),s("div",Et,[a[12]||(a[12]=o("div",{class:"loading-spinner mx-auto"},null,-1)),o("div",Lt,[o("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:x({width:`${c(r).processingProgress}%`})},null,4)]),o("p",$t,d(e.$t("segmentation.processing"))+": "+d(c(r).processingProgress)+"%",1)])):c(r).hasSegmentation?(m(),s("div",Zt,[a[14]||(a[14]=o("div",{class:"text-green-600"},[o("svg",{class:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),o("p",At,d(e.$t("segmentation.completed")),1),o("button",{onClick:a[0]||(a[0]=(...e)=>c(t).nextStep&&c(t).nextStep(...e)),class:"btn btn-primary btn-lg"},[u(d(e.$t("segmentation.nextStep"))+" ",1),a[13]||(a[13]=o("svg",{class:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1))])])):n("",!0)])])):"background"===c(t).currentStep?(m(),s("div",Dt,[o("div",Rt,[o("div",Ft,[I(he,{"original-image":c(l).uploadedFile?.imageBitmap,"segmentation-mask":c(r).segmentation?.mask,background:c(v).selectedBackground,size:512,onRendered:y,onReprocess:M},null,8,["original-image","segmentation-mask","background"])]),o("div",Pt,[I(We,{onBackgroundChanged:w}),o("div",Ht,[a[18]||(a[18]=o("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"抠图质量设置",-1)),o("div",_t,[o("label",Gt,[k(o("input",{type:"radio",value:!0,"onUpdate:modelValue":a[1]||(a[1]=e=>c(r).useQuickMode=e),class:"radio radio-primary radio-sm"},null,512),[[j,c(r).useQuickMode]]),a[15]||(a[15]=o("span",{class:"ml-2 text-sm"},[o("span",{class:"font-medium"},"快速模式"),o("span",{class:"text-gray-500 block text-xs"},"速度快，适合简单背景")],-1))]),o("label",Ut,[k(o("input",{type:"radio",value:!1,"onUpdate:modelValue":a[2]||(a[2]=e=>c(r).useQuickMode=e),class:"radio radio-primary radio-sm"},null,512),[[j,c(r).useQuickMode]]),a[16]||(a[16]=o("span",{class:"ml-2 text-sm"},[o("span",{class:"font-medium"},"高质量模式"),o("span",{class:"text-gray-500 block text-xs"},"质量高，处理复杂背景")],-1))])]),o("button",{onClick:f,class:"btn btn-sm btn-outline mt-3",disabled:c(r).isProcessing},[...a[17]||(a[17]=[o("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),u(" 重新抠图 ",-1)])],8,Qt)]),o("div",Vt,[o("button",{onClick:a[3]||(a[3]=(...e)=>c(t).previousStep&&c(t).previousStep(...e)),class:"btn btn-outline"},[...a[19]||(a[19]=[o("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16l-4-4m0 0l4-4m-4 4h18"})],-1),u(" 返回上一步 ",-1)])]),o("button",{onClick:a[4]||(a[4]=(...e)=>c(t).nextStep&&c(t).nextStep(...e)),class:"btn btn-primary",disabled:!c(v).selectedBackground},[...a[20]||(a[20]=[u(" 下载头像 ",-1),o("svg",{class:"w-5 h-5 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)])],8,Wt)])])])])):"download"===c(t).currentStep?(m(),s("div",Tt,[o("div",Nt,[o("div",Jt,[I(he,{"original-image":c(l).uploadedFile?.imageBitmap,"segmentation-mask":c(r).segmentation?.mask,background:c(v).selectedBackground,size:512,onRendered:C},null,8,["original-image","segmentation-mask","background"])]),o("div",Ot,[I(Ma,{canvas:g.value,"original-image":c(l).uploadedFile?.imageBitmap,"segmentation-mask":c(r).segmentation?.mask,background:c(v).selectedBackground,onDownloadStart:B,onDownloadComplete:S,onDownloadError:L},null,8,["canvas","original-image","segmentation-mask","background"]),o("div",Kt,[o("button",{onClick:a[5]||(a[5]=(...e)=>c(t).previousStep&&c(t).previousStep(...e)),class:"btn btn-outline"},[...a[21]||(a[21]=[o("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16l-4-4m0 0l4-4m-4 4h18"})],-1),u(" 返回上一步 ",-1)])]),o("button",{onClick:a[6]||(a[6]=(...e)=>c(t).resetApp&&c(t).resetApp(...e)),class:"btn btn-success"},[...a[22]||(a[22]=[o("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),u(" 制作新头像 ",-1)])])])])])])):n("",!0)]),c(t).hasAnyError?(m(),s("div",Yt,[o("div",Xt,[a[23]||(a[23]=o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("div",null,[o("h4",qt,d(c(t).currentError?.message),1),o("p",el,"错误代码: "+d(c(t).currentError?.code),1)]),o("button",{onClick:a[7]||(a[7]=(...e)=>c(t).clearAllErrors&&c(t).clearAllErrors(...e)),class:"btn btn-sm btn-ghost"},"关闭")])])):n("",!0)])]))}});export{al as default};
