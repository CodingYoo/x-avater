const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./selfie_segmentation-Dn7igsKe.js","./mediapipe-vendor-CTk-WiZN.js","./Home-UoqxpgND.js","./vue-vendor-DBUtO3nC.js","./ui-vendor-BeTP97BE.js","./Home-DVNjYqh-.css"])))=>i.map(i=>d[i]);
import{k as e,r as t,c as a,d as i,l as s,m as r,n,t as o,p as l,q as c,o as u,u as d,F as m,v as g,x as p,y as h,z as v,A as f,B as w,C as b,D as y,b as I,j as k,E as x,G as S,H as P,I as z,J as E,K as M}from"./vue-vendor-DBUtO3nC.js";import{u as A,c as C}from"./ui-vendor-BeTP97BE.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const B={},T=function(e,t,a){let i=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const s=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),n=r?.nonce||r?.getAttribute("nonce");i=e(t.map(e=>{if(e=function(e,t){return new URL(e,t).href}(e,a),e in B)return;B[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(!!a)for(let a=s.length-1;a>=0;a--){const i=s[a];if(i.href===e&&(!t||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${e}"]${i}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,n&&r.setAttribute("nonce",n),document.head.appendChild(r),t?new Promise((t,a)=>{r.addEventListener("load",t),r.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},L=e("upload",()=>{const e=t(null),i=t(!1),s=t(null),r=a(()=>null!==e.value),n=a(()=>e.value?.url||""),o=a(()=>e.value?.file.size||0),l=a(()=>e.value?.file.name||""),c=e=>{if(!["image/jpeg","image/png","image/webp"].includes(e.type))return{code:"INVALID_FILE_TYPE",message:"仅支持 JPG、PNG、WEBP 格式的图片",details:{type:e.type}};const t=5242880;return e.size>t?{code:"FILE_TOO_LARGE",message:"文件大小不能超过 5MB",details:{size:e.size,maxSize:t}}:null};return{uploadedFile:e,isUploading:i,error:s,hasFile:r,fileUrl:n,fileSize:o,fileName:l,uploadFile:async t=>{i.value=!0,s.value=null;try{const a=c(t);if(a)return s.value=a,!1;const i=URL.createObjectURL(t),r=await(async e=>new Promise((t,a)=>{const i=new Image;i.onload=async()=>{try{const e=await window.createImageBitmap(i);t(e)}catch(e){a(new Error("Failed to create ImageBitmap"))}},i.onerror=()=>a(new Error("Failed to load image")),i.src=URL.createObjectURL(e)}))(t);return e.value={file:t,url:i,width:r.width,height:r.height,imageBitmap:r},!0}catch(a){return s.value={code:"UPLOAD_FAILED",message:"文件上传失败，请重试",details:a},!1}finally{i.value=!1}},clearFile:()=>{e.value?.url&&URL.revokeObjectURL(e.value.url),e.value?.imageBitmap&&e.value.imageBitmap.close(),e.value=null,s.value=null},clearError:()=>{s.value=null},validateFile:c}});const N=new class{metrics={};observers=[];timers=new Map;constructor(){this.initializeObservers(),this.measureCoreWebVitals()}initializeObservers(){if("PerformanceObserver"in window){try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())if("navigation"===t.entryType){const e=t;this.metrics.ttfb=e.responseStart-e.requestStart}});e.observe({entryTypes:["navigation"]}),this.observers.push(e)}catch(e){}try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())t.name.includes("mediapipe")||t.name.includes(".wasm")});e.observe({entryTypes:["resource"]}),this.observers.push(e)}catch(e){}}}measureCoreWebVitals(){this.measureFCP(),this.measureLCP(),this.measureFID(),this.measureCLS()}measureFCP(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())"first-contentful-paint"===t.name&&(this.metrics.fcp=t.startTime)});e.observe({entryTypes:["paint"]}),this.observers.push(e)}catch(e){}}measureLCP(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),a=t[t.length-1];this.metrics.lcp=a.startTime});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}catch(e){}}measureFID(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries()){const e=t;e.processingStart&&(this.metrics.fid=e.processingStart-t.startTime)}});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}catch(e){}}measureCLS(){if("PerformanceObserver"in window)try{let e=0;const t=new PerformanceObserver(t=>{for(const a of t.getEntries()){const t=a;!t.hadRecentInput&&t.value&&(e+=t.value)}this.metrics.cls=e});t.observe({entryTypes:["layout-shift"]}),this.observers.push(t)}catch(e){}}startTimer(e){this.timers.set(e,performance.now())}endTimer(e){const t=this.timers.get(e);if(t){const a=performance.now()-t;switch(this.timers.delete(e),e){case"imageProcessing":this.metrics.imageProcessingTime=a;break;case"segmentation":this.metrics.segmentationTime=a;break;case"render":this.metrics.renderTime=a;break;case"download":this.metrics.downloadTime=a}return a}return 0}measureMemoryUsage(){if("memory"in performance){const e=performance.memory;this.metrics.memoryUsage={used:e.usedJSHeapSize,total:e.totalJSHeapSize,percentage:e.usedJSHeapSize/e.totalJSHeapSize*100}}}measureNetworkInfo(){if("connection"in navigator){const e=navigator.connection;this.metrics.networkType=e.type,this.metrics.effectiveType=e.effectiveType}}getPerformanceReport(){return this.measureMemoryUsage(),this.measureNetworkInfo(),{...this.metrics}}checkPerformanceRequirements(){const e=[];return this.metrics.fcp&&this.metrics.fcp>1500&&e.push(`首屏渲染时间过长: ${this.metrics.fcp}ms (要求 ≤ 1500ms)`),this.metrics.lcp&&this.metrics.lcp>2500&&e.push(`最大内容渲染时间过长: ${this.metrics.lcp}ms (要求 ≤ 2500ms)`),this.metrics.segmentationTime&&this.metrics.segmentationTime>2e3&&e.push(`AI分割时间过长: ${this.metrics.segmentationTime}ms (要求 ≤ 2000ms)`),this.metrics.memoryUsage&&this.metrics.memoryUsage.percentage>80&&e.push(`内存使用过高: ${this.metrics.memoryUsage.percentage.toFixed(2)}% (要求 ≤ 80%)`),{passed:0===e.length,issues:e}}cleanup(){this.observers.forEach(e=>e.disconnect()),this.observers=[],this.timers.clear()}};class D{static async quickSegment(e){const t=document.createElement("canvas"),a=t.getContext("2d");t.width=e.width,t.height=e.height,a.drawImage(e,0,0);const i=a.getImageData(0,0,t.width,t.height),s=i.data,r=t.width/2,n=t.height/2,o=.4*Math.min(t.width,t.height);for(let l=0;l<s.length;l+=4){const e=l/4,a=e%t.width,i=Math.floor(e/t.width),c=Math.sqrt((a-r)**2+(i-n)**2);if(c>o)s[l+3]=0;else{const e=Math.max(0,1-c/o*.3);s[l+3]=Math.floor(s[l+3]*e)}}return a.putImageData(i,0,0),createImageBitmap(t)}}const j=new class{selfieSegmentation=null;isInitialized=!1;isInitializing=!1;wasmCache=new Map;modelCache=new Map;async initialize(){if(this.isInitialized)return!0;if(this.isInitializing){for(;this.isInitializing;)await new Promise(e=>setTimeout(e,100));return this.isInitialized}this.isInitializing=!0,N.startTimer("mediapipe-init");try{const t="selfie_segmentation_v1";if(this.modelCache.has(t))return this.selfieSegmentation=this.modelCache.get(t),this.isInitialized=!0,N.endTimer("mediapipe-init"),!0;let a;try{const e=await T(()=>import("./selfie_segmentation-Dn7igsKe.js").then(e=>e.s),__vite__mapDeps([0,1]),import.meta.url);if(a=e.SelfieSegmentation,a||(a=e.default?.SelfieSegmentation||e.default),a||(a=window.SelfieSegmentation),!a||"function"!=typeof a)throw new Error("SelfieSegmentation constructor not available")}catch(e){throw new Error(`Failed to import MediaPipe: ${e}`)}return this.selfieSegmentation=new a({locateFile:e=>{const t=`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${e}`;return e.endsWith(".wasm")&&!this.wasmCache.has(e)&&this.preloadWasm(t,e),t}}),this.selfieSegmentation&&this.selfieSegmentation.setOptions({modelSelection:0}),this.modelCache.set(t,this.selfieSegmentation),this.isInitialized=!0,N.endTimer("mediapipe-init"),!0}catch(t){return this.isInitialized=!1,N.endTimer("mediapipe-init"),!1}finally{this.isInitializing=!1}}async preloadWasm(e,t){try{const a=await fetch(e),i=await a.arrayBuffer();this.wasmCache.set(t,i)}catch(a){}}async quickSegment(e,t){N.startTimer("segmentation"),t&&t(20);try{const a=await D.quickSegment(e);return t&&t(100),N.endTimer("segmentation"),{segmentationMask:a}}catch(a){throw N.endTimer("segmentation"),new Error(`Quick segmentation failed: ${a}`)}}async segmentImage(e,t){if(!this.isInitialized||!this.selfieSegmentation){if(!(await this.initialize()))throw new Error("Failed to initialize MediaPipe")}return N.startTimer("segmentation"),new Promise((a,i)=>{Date.now();t&&t(10),this.selfieSegmentation.onResults(e=>{try{Date.now();N.endTimer("segmentation"),t&&t(100),a(e)}catch(s){N.endTimer("segmentation"),i(new Error(`Segmentation processing failed: ${s}`))}});try{t&&t(50),this.selfieSegmentation.send({image:e})}catch(s){N.endTimer("segmentation"),i(new Error(`Failed to send image to MediaPipe: ${s}`))}})}createCompositeImage(e,t,a,i={width:512,height:512}){N.startTimer("render");const s=document.createElement("canvas"),r=s.getContext("2d",{alpha:!1,desynchronized:!0});let n,o;return s.width=i.width,s.height=i.height,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.clearRect(0,0,s.width,s.height),"string"==typeof a?(r.fillStyle=a,r.fillRect(0,0,s.width,s.height)):r.drawImage(a,0,0,s.width,s.height),"undefined"!=typeof OffscreenCanvas?(n=new OffscreenCanvas(s.width,s.height),o=n.getContext("2d",{alpha:!0})):(n=document.createElement("canvas"),o=n.getContext("2d",{alpha:!0}),n.width=s.width,n.height=s.height),o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(e,0,0,s.width,s.height),o.globalCompositeOperation="destination-in",o.drawImage(t,0,0,s.width,s.height),n instanceof OffscreenCanvas?n.convertToBlob().then(e=>{createImageBitmap(e).then(e=>{r.drawImage(e,0,0),e.close()})}):r.drawImage(n,0,0),N.endTimer("render"),s}static checkCompatibility(){const e=[];return"undefined"==typeof WebAssembly&&e.push("WebAssembly not supported"),document.createElement("canvas").getContext||e.push("Canvas not supported"),"undefined"==typeof createImageBitmap&&e.push("ImageBitmap not supported"),{compatible:0===e.length,issues:e}}cleanup(){this.selfieSegmentation&&(this.selfieSegmentation.close(),this.selfieSegmentation=null),this.isInitialized=!1,this.isInitializing=!1}get initialized(){return this.isInitialized}},F=e("segmentation",()=>{const e=t(null),i=t(!1),s=t(null),r=t(!1),n=t(!0),o=a(()=>null!==e.value),l=t(0),c=async()=>{if(r.value)return!0;try{return await j.initialize()?(r.value=!0,!0):(s.value={code:"MEDIAPIPE_INIT_FAILED",message:"AI模型加载失败，请检查网络连接",details:"MediaPipe initialization failed"},!1)}catch(e){return s.value={code:"MEDIAPIPE_INIT_FAILED",message:"AI模型加载失败，将使用快速模式",details:e},!0}},u=()=>{e.value?.mask&&e.value.mask.close(),e.value=null,s.value=null,l.value=0};return{segmentation:e,isProcessing:i,error:s,useQuickMode:n,isModelLoaded:r,processingProgress:l,hasSegmentation:o,initializeMediaPipe:c,performSegmentation:async t=>{i.value=!0,s.value=null,l.value=0;try{let a;if(n.value)a=await j.quickSegment(t,e=>{l.value=e});else{if(!r.value){if(!(await c()))return!1}a=await j.segmentImage(t,e=>{l.value=e})}return a&&a.segmentationMask?(e.value={mask:a.segmentationMask,width:a.segmentationMask.width,height:a.segmentationMask.height},i.value=!1,!0):(s.value={code:"SEGMENTATION_FAILED",message:"人像分割失败，请重试",details:"No results returned from segmentation"},i.value=!1,!1)}catch(a){return s.value={code:"SEGMENTATION_FAILED",message:"人像分割失败，请重试",details:a},i.value=!1,!1}},clearSegmentation:u,cleanup:()=>{j.cleanup(),r.value=!1,u()},clearError:()=>{s.value=null},toggleSegmentationMode:()=>{n.value=!n.value},setSegmentationMode:e=>{n.value=e}}}),G=["#FFFFFF","#438EDB","#FF0000","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F"],R=e("background",()=>{const e=t({type:"color",value:G[0]}),i=t(!1),s=t(null),r=a(()=>"color"===e.value.type),n=a(()=>"image"===e.value.type),o=a(()=>e.value.value),l=e=>{if(!["image/jpeg","image/png","image/webp"].includes(e.type))return{code:"INVALID_BACKGROUND_TYPE",message:"背景图片仅支持 JPG、PNG、WEBP 格式",details:{type:e.type}};const t=10485760;return e.size>t?{code:"BACKGROUND_TOO_LARGE",message:"背景图片大小不能超过 10MB",details:{size:e.size,maxSize:t}}:null};return{selectedBackground:e,isLoadingBackground:i,error:s,isColorBackground:r,isImageBackground:n,backgroundValue:o,setColorBackground:t=>{n.value&&e.value.value instanceof ImageBitmap&&e.value.value.close(),e.value={type:"color",value:t},s.value=null},setImageBackground:async t=>{i.value=!0,s.value=null;try{const a=l(t);if(a)return s.value=a,!1;n.value&&e.value.value instanceof ImageBitmap&&e.value.value.close();const i=await(async e=>new Promise((t,a)=>{const i=new Image;i.onload=async()=>{try{const e=await window.createImageBitmap(i);t(e)}catch(e){a(new Error("Failed to create background ImageBitmap"))}},i.onerror=()=>a(new Error("Failed to load background image")),i.src=URL.createObjectURL(e)}))(t);return e.value={type:"image",value:i},!0}catch(a){return s.value={code:"BACKGROUND_LOAD_FAILED",message:"背景图片加载失败，请重试",details:a},!1}finally{i.value=!1}},resetBackground:()=>{n.value&&e.value.value instanceof ImageBitmap&&e.value.value.close(),e.value={type:"color",value:G[0]},s.value=null},clearError:()=>{s.value=null},getPresetColors:()=>[...G],cleanup:()=>{n.value&&e.value.value instanceof ImageBitmap&&e.value.value.close()},validateBackgroundFile:l}}),_=e("app",()=>{const e=t("upload"),i=t(!1),s=t(null),r=L(),n=F(),o=R(),l=a(()=>r.hasFile&&!r.isUploading),c=a(()=>l.value&&n.hasSegmentation&&!n.isProcessing),u=a(()=>c.value&&null!==o.selectedBackground),d=a(()=>{let t=0;return r.hasFile&&(t+=25),n.hasSegmentation&&(t+=25),o.selectedBackground&&(t+=25),"download"===e.value&&(t+=25),t}),m=a(()=>!!(s.value||r.error||n.error||o.error)),g=a(()=>s.value||r.error||n.error||o.error),p=t=>{e.value=t},h=e=>{s.value=e},v=()=>{s.value=null,r.clearError(),n.clearError(),o.clearError()};return{currentStep:e,isLoading:i,globalError:s,canProceedToSegment:l,canProceedToBackground:c,canDownload:u,overallProgress:d,hasAnyError:m,currentError:g,setStep:p,nextStep:()=>{switch(e.value){case"upload":l.value&&(e.value="segment");break;case"segment":c.value&&(e.value="background");break;case"background":u.value&&(e.value="download")}},previousStep:()=>{switch(e.value){case"segment":e.value="upload";break;case"background":e.value="segment";break;case"download":e.value="background"}},resetApp:()=>{e.value="upload",i.value=!1,s.value=null,r.clearFile(),n.clearSegmentation(),o.resetBackground()},setGlobalError:h,clearAllErrors:v,processImage:async()=>{if(!r.uploadedFile?.imageBitmap)return h({code:"NO_IMAGE",message:"请先上传图片"}),!1;i.value=!0,v();try{p("segment");return!!(await n.performSegmentation(r.uploadedFile.imageBitmap))&&(p("background"),!0)}catch(e){return h({code:"PROCESSING_FAILED",message:"图像处理失败，请重试",details:e}),!1}finally{i.value=!1}},cleanup:()=>{r.clearFile(),n.cleanup(),o.cleanup()}}}),O={key:0,class:"error-boundary"},U={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Z={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},W={class:"text-lg font-semibold text-gray-900 text-center mb-2"},H={class:"text-gray-600 text-center mb-6"},$={key:0,class:"mb-6"},K={class:"bg-gray-50 rounded-lg p-4"},Y={class:"text-xs text-gray-600 overflow-auto max-h-32"},J={class:"flex flex-col sm:flex-row gap-3"},q=["disabled"],V={key:0,class:"w-4 h-4 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Q={key:1},X=(e,t)=>{const a=e.__vccOpts||e;for(const[i,s]of t)a[i]=s;return a},ee=X(i({__name:"ErrorBoundary",props:{error:{default:null},title:{default:"出现了一个错误"},showDetails:{type:Boolean,default:!1},retryable:{type:Boolean,default:!0}},emits:["retry","reset","report"],setup(e,{emit:i}){const u=e,d=i,m=t(!1),g=a(()=>null!==u.error),p=a(()=>"string"==typeof u.error?u.title:u.error instanceof Error&&u.error.name||u.title),h=a(()=>"string"==typeof u.error?u.error:u.error instanceof Error&&u.error.message||"发生了未知错误"),v=a(()=>u.error instanceof Error?u.error.stack||u.error.toString():"string"==typeof u.error?u.error:null),f=async()=>{if(u.retryable){m.value=!0;try{d("retry"),await new Promise(e=>setTimeout(e,1e3))}finally{m.value=!1}}},w=()=>{d("reset")},b=()=>{d("report",u.error||"Unknown error")},y=()=>{window.location.href="./simple.html"};return(e,t)=>g.value?(c(),s("div",O,[n("div",U,[n("div",Z,[t[5]||(t[5]=n("div",{class:"flex items-center justify-center mb-4"},[n("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center"},[n("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),n("h3",W,o(p.value),1),n("p",H,o(h.value),1),e.showDetails&&v.value?(c(),s("div",$,[n("details",K,[t[0]||(t[0]=n("summary",{class:"cursor-pointer text-sm font-medium text-gray-700 mb-2"}," 错误详情 ",-1)),n("pre",Y,o(v.value),1)])])):r("",!0),n("div",J,[n("button",{onClick:f,class:"flex-1 btn btn-primary",disabled:m.value},[m.value?(c(),s("svg",V,[...t[1]||(t[1]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(c(),s("span",Q,[...t[2]||(t[2]=[n("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])),l(" "+o(m.value?"重试中...":"重试"),1)],8,q),n("button",{onClick:w,class:"flex-1 btn btn-outline"},[...t[3]||(t[3]=[n("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1),l(" 重新开始 ",-1)])]),n("button",{onClick:y,class:"flex-1 btn btn-secondary"},[...t[4]||(t[4]=[n("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),l(" 简化版 ",-1)])])]),n("div",{class:"mt-4 text-center"},[n("button",{onClick:b,class:"text-sm text-gray-500 hover:text-gray-700 underline"}," 报告此问题 ")])])])])):r("",!0)}}),[["__scopeId","data-v-09fde369"]]),te={key:0,class:"browser-compatibility"},ae={class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"},ie={class:"bg-white rounded-lg shadow-xl max-w-lg w-full p-6"},se={class:"mb-6"},re={class:"space-y-2"},ne={class:"mb-6"},oe={class:"grid grid-cols-2 gap-3"},le=["href"],ce={class:"w-8 h-8 mr-3 flex-shrink-0"},ue=["src","alt"],de={class:"text-sm font-medium text-gray-900"},me={class:"text-xs text-gray-500"},ge={class:"mt-4"},pe={class:"text-sm"},he={class:"mt-2 p-3 bg-gray-50 rounded text-xs text-gray-600"},ve=X(i({__name:"BrowserCompatibility",emits:["continue","recheck"],setup(e,{emit:i}){const p=i,h=t([]),v=t(""),f=[{name:"Chrome",version:"90",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM0Mjg1RjQiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iNiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+",downloadUrl:"https://www.google.com/chrome/"},{name:"Firefox",version:"88",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNGRjk1MDAiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iNiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+",downloadUrl:"https://www.mozilla.org/firefox/"},{name:"Safari",version:"14",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMwMDdBRkYiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iNiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+",downloadUrl:"https://www.apple.com/safari/"},{name:"Edge",version:"90",icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMwMDc4RDQiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iNiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+",downloadUrl:"https://www.microsoft.com/edge"}],w=a(()=>0===h.value.length),b=()=>{const e=[];v.value=navigator.userAgent,"undefined"==typeof WebAssembly&&e.push("webassembly");const t=document.createElement("canvas");t.getContext&&t.getContext("2d")||e.push("canvas"),"undefined"==typeof createImageBitmap&&e.push("imagebitmap"),"undefined"==typeof fetch&&e.push("fetch"),"undefined"==typeof Promise&&e.push("promise");try{new Function('import("")')}catch{e.push("modules")}"undefined"!=typeof File&&"undefined"!=typeof FileReader||e.push("fileapi"),"undefined"!=typeof URL&&void 0!==URL.createObjectURL||e.push("objecturl");const a=/Chrome\/([0-9]+)/.test(v.value)&&parseInt(RegExp.$1)<90,i=/Firefox\/([0-9]+)/.test(v.value)&&parseInt(RegExp.$1)<88,s=/Version\/([0-9]+).*Safari/.test(v.value)&&parseInt(RegExp.$1)<14,r=/Edg\/([0-9]+)/.test(v.value)&&parseInt(RegExp.$1)<90;(a||i||s||r)&&e.push("oldversion"),/MSIE|Trident/.test(v.value)&&e.push("ie"),h.value=e},y=e=>({webassembly:"WebAssembly 不受支持",canvas:"Canvas API 不受支持",imagebitmap:"ImageBitmap API 不受支持",fetch:"Fetch API 不受支持",promise:"Promise 不受支持",modules:"ES6 模块不受支持",fileapi:"File API 不受支持",objecturl:"URL.createObjectURL 不受支持",oldversion:"浏览器版本过旧",ie:"Internet Explorer 不受支持"}[e]||"未知兼容性问题"),I=()=>{p("continue")},k=()=>{b(),p("recheck")};return u(()=>{b()}),(e,t)=>w.value?r("",!0):(c(),s("div",te,[n("div",ae,[n("div",ie,[t[7]||(t[7]=d('<div class="flex items-center justify-center mb-4" data-v-7851ead2><div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center" data-v-7851ead2><svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7851ead2><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-7851ead2></path></svg></div></div><h3 class="text-lg font-semibold text-gray-900 text-center mb-2" data-v-7851ead2> 浏览器兼容性问题 </h3><p class="text-gray-600 text-center mb-6" data-v-7851ead2> 您的浏览器可能不支持此应用的某些功能。为了获得最佳体验，请升级您的浏览器或使用推荐的浏览器。 </p>',3)),n("div",se,[t[1]||(t[1]=n("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"检测到的问题：",-1)),n("ul",re,[(c(!0),s(m,null,g(h.value,e=>(c(),s("li",{key:e,class:"flex items-center text-sm text-red-600"},[t[0]||(t[0]=n("svg",{class:"w-4 h-4 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),l(" "+o(y(e)),1)]))),128))])]),n("div",ne,[t[2]||(t[2]=n("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"推荐浏览器：",-1)),n("div",oe,[(c(),s(m,null,g(f,e=>n("a",{key:e.name,href:e.downloadUrl,target:"_blank",class:"flex items-center p-3 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors"},[n("div",ce,[n("img",{src:e.icon,alt:e.name,class:"w-full h-full"},null,8,ue)]),n("div",null,[n("div",de,o(e.name),1),n("div",me,o(e.version)+"+",1)])],8,le)),64))])]),n("div",{class:"flex flex-col sm:flex-row gap-3"},[n("button",{onClick:I,class:"flex-1 btn btn-outline"}," 仍要继续 "),n("button",{onClick:k,class:"flex-1 btn btn-primary"},[...t[3]||(t[3]=[n("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),l(" 重新检测 ",-1)])])]),n("div",ge,[n("details",pe,[t[6]||(t[6]=n("summary",{class:"cursor-pointer text-gray-500 hover:text-gray-700"}," 查看详细信息 ",-1)),n("div",he,[n("div",null,[t[4]||(t[4]=n("strong",null,"用户代理:",-1)),l(" "+o(v.value),1)]),n("div",null,[t[5]||(t[5]=n("strong",null,"检测时间:",-1)),l(" "+o((new Date).toLocaleString()),1)])])])])])])]))}}),[["__scopeId","data-v-7851ead2"]]),fe={key:0,class:"loading-overlay"},we={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40"},be={class:"bg-white rounded-lg shadow-xl p-8 max-w-sm w-full mx-4"},ye={class:"flex flex-col items-center"},Ie={key:0,class:"loading-spinner-large mb-4"},ke={key:1,class:"loading-dots mb-4"},xe={key:2,class:"loading-pulse mb-4"},Se={key:3,class:"w-full mb-4"},Pe={class:"progress-bar"},ze={class:"text-center text-sm text-gray-600 mt-2"},Ee={class:"text-lg font-semibold text-gray-900 mb-2 text-center"},Me={key:4,class:"text-gray-600 text-center text-sm mb-4"},Ae={key:5,class:"w-full"},Ce={class:"space-y-2"},Be={class:"w-4 h-4 mr-3 flex-shrink-0"},Te={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Le={key:1,class:"w-2 h-2 bg-current rounded-full animate-pulse"},Ne={key:2,class:"w-2 h-2 bg-current rounded-full opacity-30"},De={key:7,class:"mt-4 text-xs text-gray-500 text-center"},je=X(i({__name:"LoadingOverlay",props:{visible:{type:Boolean,default:!1},type:{default:"spinner"},title:{default:"加载中..."},message:{default:""},progress:{default:0},steps:{default:()=>[]},currentStep:{default:0},cancellable:{type:Boolean,default:!1},estimatedTime:{default:0}},emits:["cancel"],setup(e){const t=e=>{if(e<60)return`${Math.round(e)} 秒`;if(e<3600){return`${Math.floor(e/60)} 分 ${Math.round(e%60)} 秒`}return`${Math.floor(e/3600)} 小时 ${Math.floor(e%3600/60)} 分钟`};return(e,a)=>(c(),p(v,{name:"fade"},{default:h(()=>[e.visible?(c(),s("div",fe,[n("div",we,[n("div",be,[n("div",ye,["spinner"===e.type?(c(),s("div",Ie)):"dots"===e.type?(c(),s("div",ke,[...a[1]||(a[1]=[n("div",{class:"dot"},null,-1),n("div",{class:"dot"},null,-1),n("div",{class:"dot"},null,-1)])])):"pulse"===e.type?(c(),s("div",xe,[...a[2]||(a[2]=[n("div",{class:"pulse-circle"},null,-1)])])):"progress"===e.type?(c(),s("div",Se,[n("div",Pe,[n("div",{class:"progress-fill transition-all duration-300",style:f({width:`${e.progress}%`})},null,4)]),n("div",ze,o(e.progress)+"% ",1)])):r("",!0),n("h3",Ee,o(e.title),1),e.message?(c(),s("p",Me,o(e.message),1)):r("",!0),e.steps&&e.steps.length>0?(c(),s("div",Ae,[n("div",Ce,[(c(!0),s(m,null,g(e.steps,(t,i)=>(c(),s("div",{key:i,class:w(["flex items-center text-sm",{"text-green-600":i<e.currentStep,"text-blue-600":i===e.currentStep,"text-gray-400":i>e.currentStep}])},[n("div",Be,[i<e.currentStep?(c(),s("svg",Te,[...a[3]||(a[3]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):i===e.currentStep?(c(),s("div",Le)):(c(),s("div",Ne))]),l(" "+o(t),1)],2))),128))])])):r("",!0),e.cancellable?(c(),s("button",{key:6,onClick:a[0]||(a[0]=t=>e.$emit("cancel")),class:"mt-4 btn btn-outline btn-sm"}," 取消 ")):r("",!0),e.estimatedTime?(c(),s("div",De," 预计还需 "+o(t(e.estimatedTime)),1)):r("",!0)])])])])):r("",!0)]),_:1}))}}),[["__scopeId","data-v-4c400c64"]]),Fe={id:"app"},Ge=i({__name:"App",setup(e){const i=_(),{t:n}=A(),o=(y(),t(null)),l=t(!0),d=a(()=>[n("loading.steps.compatibility"),n("loading.steps.resources"),n("loading.steps.state"),n("loading.steps.ui")]),m=t(0);b(e=>(o.value=e,!1));const g=e=>{o.value=e},h=()=>{o.value=null},v=()=>{o.value=null,i.resetApp()},f=e=>{},w=()=>{},P=()=>{},z=e=>{g(new Error(e.message))},E=e=>{g(new Error(e.reason))};return u(()=>{window.addEventListener("error",z),window.addEventListener("unhandledrejection",E),(async()=>{try{m.value=0,await new Promise(e=>setTimeout(e,300)),m.value=1,await new Promise(e=>setTimeout(e,400)),m.value=2,await new Promise(e=>setTimeout(e,200)),m.value=3,await new Promise(e=>setTimeout(e,200)),l.value=!1}catch(e){o.value=e instanceof Error?e:new Error("初始化失败"),l.value=!1}})()}),I(()=>{i.cleanup(),window.removeEventListener("error",z),window.removeEventListener("unhandledrejection",E)}),(e,t)=>{const a=S("RouterView");return c(),s("div",Fe,[k(ve,{onContinue:w,onRecheck:P}),k(je,{visible:l.value,type:"progress",title:x(n)("loading.initializing"),message:x(n)("loading.subtitle"),steps:d.value,"current-step":m.value,progress:(m.value+1)/d.value.length*100},null,8,["visible","title","message","steps","current-step","progress"]),k(ee,{error:o.value,title:"应用遇到了问题","show-details":!0,onRetry:h,onReset:v,onReport:f},null,8,["error"]),l.value||o.value?r("",!0):(c(),p(a,{key:0}))])}}}),Re=[{code:"zh-CN",name:"简体中文",flag:"🇨🇳"},{code:"en-US",name:"English",flag:"🇺🇸"}];const _e=C({legacy:!1,locale:function(){try{const e=localStorage.getItem("app-locale");if(e&&Re.some(t=>t.code===e))return e}catch(e){}return null}()||function(){try{const e=navigator.language||navigator.languages?.[0]||"zh-CN";for(const t of Re)if(e.startsWith(t.code.split("-")[0]))return t.code}catch(e){}return"zh-CN"}(),fallbackLocale:"zh-CN",messages:{"zh-CN":{app:{title:"头像换背景",subtitle:"AI智能头像换背景",description:"一键更换头像背景，AI智能抠图，快速生成个性化头像"},header:{progress:"进度",languageSwitch:"切换语言"},steps:{upload:"上传图片",segment:"AI抠图",background:"选择背景",download:"下载结果"},upload:{title:"上传头像图片",subtitle:"点击或拖拽图片到此区域",formats:"支持格式：JPG、PNG、WEBP",maxSize:"文件大小：最大 5MB",recommended:"建议尺寸：512×512 像素或更高",processing:"正在处理图片...",success:"图片上传成功",reupload:"重新上传",proceed:"开始AI抠图",size:"尺寸",fileSize:"大小",errors:{currentSize:"当前文件大小"}},segmentation:{title:"AI智能抠图",subtitle:"正在使用AI技术分离人像和背景...",processing:"处理进度",completed:"抠图完成！",nextStep:"选择背景"},background:{title:"选择背景",subtitle:"选择预设颜色或上传自定义背景图片",colorTab:"纯色背景",imageTab:"图片背景"},loading:{title:"加载中...",initializing:"正在启动应用",subtitle:"请稍候，我们正在为您准备最佳体验",steps:{compatibility:"检查浏览器兼容性",resources:"加载应用资源",state:"初始化状态管理",ui:"准备用户界面"}},common:{ok:"确定",cancel:"取消",loading:"加载中",success:"成功",error:"错误"}},"en-US":{app:{title:"Avatar Background Swap",subtitle:"AI-Powered Avatar Background Replacement",description:"One-click avatar background replacement with AI-powered image segmentation"},header:{progress:"Progress",languageSwitch:"Switch Language"},steps:{upload:"Upload Image",segment:"AI Segmentation",background:"Choose Background",download:"Download Result"},upload:{title:"Upload Avatar Image",subtitle:"Click or drag image to this area",formats:"Supported formats: JPG, PNG, WEBP",maxSize:"File size: Max 5MB",recommended:"Recommended size: 512×512 pixels or higher",processing:"Processing image...",success:"Image uploaded successfully",reupload:"Re-upload",proceed:"Start AI Segmentation",size:"Size",fileSize:"File Size",errors:{currentSize:"Current file size"}},segmentation:{title:"AI Smart Segmentation",subtitle:"Using AI technology to separate portrait and background...",processing:"Processing progress",completed:"Segmentation completed!",nextStep:"Choose Background"},background:{title:"Choose Background",subtitle:"Select preset colors or upload custom background image",colorTab:"Solid Color",imageTab:"Image Background"},preview:{title:"Live Preview",subtitle:"View AI segmentation and background composition effects"},download:{title:"Download Result",subtitle:"Save your personalized avatar"},navigation:{previous:"Previous Step",next:"Next Step",restart:"Restart",newAvatar:"Create New Avatar"},loading:{title:"Loading...",initializing:"Starting Application",subtitle:"Please wait, we're preparing the best experience for you",steps:{compatibility:"Checking browser compatibility",resources:"Loading application resources",state:"Initializing state management",ui:"Preparing user interface"}},common:{ok:"OK",cancel:"Cancel",loading:"Loading",success:"Success",error:"Error"}}},globalInjection:!0,silentTranslationWarn:!0,missingWarn:!1,fallbackWarn:!1});function Oe(e){if(Re.some(t=>t.code===e)){_e.global.locale.value=e,function(e){try{localStorage.setItem("app-locale",e)}catch(t){}}(e),document.documentElement.lang=e;const t=_e.global.t("app.title");document.title=t}}function Ue(){return _e.global.locale.value}function Ze(e){const t=Re.find(t=>t.code===e);return t?t.name:e}function We(e){const t=Re.find(t=>t.code===e);return t?t.flag:"🌐"}const He=[{path:"/",name:"Home",component:()=>T(()=>import("./Home-UoqxpgND.js"),__vite__mapDeps([2,3,4,5]),import.meta.url)}],$e=P({history:z(),routes:He,scrollBehavior:(e,t,a)=>a||{top:0}}),Ke=E(Ge),Ye=M();!function(){document.documentElement.lang=Ue();const e=_e.global.t("app.title");document.title=e}(),Ke.use(Ye),Ke.use($e),Ke.use(_e),N.startTimer("app-mount"),Ke.mount("#app"),N.endTimer("app-mount");export{G as P,Re as S,X as _,R as a,We as b,Ze as c,_ as d,F as e,Ue as g,Oe as s,L as u};
