产品需求文档（PRD）  
项目名称：Avatar Background Swap（头像换背景）  
版本号：v1.0  
作者：产品部  
日期：2025-08-21  

1. 产品背景  
在社交媒体、招聘、游戏等场景，用户希望快速更换头像背景而无需使用 PS 或后端服务。本需求用纯前端 Vue3 技术栈实现“一键换背景”能力，上传头像 → AI 抠图 → 换背景 → 下载结果，全流程 3 秒内完成。

2. 目标用户  
• 普通 C 端：想制作个性化头像  
• 设计师：快速出 DEMO  
• 运营：批量生成活动素材（后续可扩展多文件）  

3. 需求范围（MVP）  
功能：单张图片上传、人像 AI 抠图、背景替换（颜色/图片）、实时预览、结果下载  
平台：Web（Chrome 90+、Safari 14+、Edge 90+）  
非功能：首屏 < 1.5s，抠图 < 2s，包体积 < 2 MB（gzip）

4. 用户故事  
1. 用户点击“上传头像” → 选择本地图片 → 看到抠图后透明人像  
2. 用户点击“背景” → 选择纯色或上传背景图 → 实时预览合成效果  
3. 用户点击“下载” → 获得 512×512 PNG

5. 功能详细描述  
| 模块 | 子功能 | 描述 | 验收标准 |
|---|---|---|---|
| 上传 | 拖拽/点击上传 | 支持 JPG/PNG/WEBP ≤ 5 MB | 成功读取 file 对象 |
| 人像分割 | AI 模型 | 使用 @mediapipe/selfie_segmentation（wasm 前端推理） | mIoU ≥ 94%（内部 100 张测试集） |
| 画布渲染 | 双 canvas | 一层人像（透明）、一层背景 | 缩放适配 512×512 |
| 背景库 | 颜色 | 8 个预设色 | 点击切换 |
| 背景库 | 图片 | 用户可上传第二张图作为背景 | 自动居中 cover |
| 下载 | 导出 | canvas.toBlob → download | PNG、不含 alpha 时可存 JPG |
| 异常处理 | 大图/非人像 | toast 提示 | 错误文案统一 |

6. 技术架构（纯前端）  
• 框架：Vue3 + Vite + TypeScript  
• 状态：Pinia（uploadFile、segmentation、background）  
• 组件：  
  – Upload.vue（上传区）  
  – Preview.vue（canvas 预览）  
  – BackgroundPicker.vue（颜色/图片选择）  
  – DownloadBtn.vue  
• AI：@mediapipe/selfie_segmentation 0.1.x（wasm）  
• 样式：TailwindCSS + daisyUI  
• 构建：vite-plugin-pwa（可选 PWA 离线缓存）

7. 关键流程图  
上传 → 解码 ImageBitmap → 推理 → 生成 mask → 合成 → 预览 → 下载

8. 数据与性能指标  
• 首屏 FCP ≤ 1.5 s（Lighthouse）  
• 抠图耗时 ≤ 2 s（i5-8250U Chrome）  
• bundle 大小 ≤ 2 MB（gzip）  
• crash 率 < 0.1%

9. 非功能性需求  
• 无障碍：alt 文本、键盘可访问  
• 安全：不保存用户图片，全部前端处理  
• 兼容性：Chrome 90+、Safari 14+、Edge 90+  
• 国际化：i18n 配置（en/zh-CN）

10. 里程碑  
| 阶段 | 日期 | 交付物 |
|---|---|---|
| PRD 评审 | 08-23 | 本 PRD 通过 |
| 技术方案 | 08-25 | 架构图 & 任务拆解 |
| 开发 | 08-26-09-05 | 代码 & UT |
| 联调 | 09-06-09-08 | 性能 & 兼容测试 |
| 上线 | 09-10 | 正式域名 & CDN |

11. 风险与应对  
| 风险 | 影响 | 缓解 |
|---|---|---|
| 模型体积大 | 首屏慢 | wasm 分包 + CDN |
| 低版本浏览器 | 白屏 | 加提示页 & Polyfill |
| 边缘 case 人像分割失败 | 用户体验差 | 提供“手动擦除”备用方案（后续迭代） |

12. 附录  
A. 低保真原型（Figma 链接）  
B. 关键数据结构  
```ts
interface Segmentation {
  mask: ImageBitmap  // 0-255 alpha
  width: number
  height: number
}

interface Background {
  type: 'color' | 'image'
  value: string | ImageBitmap
}
```

C. 性能预算表（bundle-analyzer 截图）